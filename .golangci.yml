# ğŸš€ Go-Masteryé¡¹ç›® - 2025å¹´æ ‡å‡†golangci-linté…ç½®
# åŸºäºgolangci-lint v1.64.8å’Œæœ€æ–°Goè´¨é‡æ ‡å‡†

# yaml-language-server: $schema=https://golangci-lint.run/jsonschema/golangci.jsonschema.json

# è¿è¡Œè®¾ç½®
run:
  timeout: 10m
  issues-exit-code: 1
  tests: true
  go: "1.24"

# è¾“å‡ºé…ç½®
output:
  formats:
    - format: colored-line-number
      path: stdout
  print-issued-lines: true
  print-linter-name: true

# é—®é¢˜è®¾ç½® - 2025å¹´ä¼˜åŒ–ç‰ˆ
issues:
  # åŸºæœ¬è®¾ç½®
  exclude-use-default: false
  exclude-case-sensitive: false
  max-issues-per-linter: 0
  max-same-issues: 0
  new: false
  fix: false
  uniq-by-line: true

  # æ’é™¤ç›®å½•
  exclude-dirs:
    - vendor
    - third_party
    - testdata
    - examples

  # æ’é™¤æ–‡ä»¶
  exclude-files:
    - ".*\\.pb\\.go$"
    - ".*_generated\\.go$"
    - ".*_mock\\.go$"
    - "wire_gen\\.go$"

  # æ’é™¤è§„åˆ™
  exclude-rules:
    # æµ‹è¯•æ–‡ä»¶å¯ä»¥æœ‰æ”¾æ¾çš„è¦æ±‚
    - path: _test\.go
      linters:
        - gocyclo        # æµ‹è¯•å‡½æ•°å¯ä»¥æ›´å¤æ‚
        - errcheck       # æµ‹è¯•ä¸­çš„é”™è¯¯å¤„ç†å¯ä»¥æ”¾æ¾
        - dupl           # æµ‹è¯•ä¸­å…è®¸é‡å¤
        - gosec          # æµ‹è¯•ä¸­çš„å®‰å…¨æ£€æŸ¥æ”¾æ¾
        - funlen         # æµ‹è¯•å‡½æ•°å¯ä»¥æ›´é•¿
        - gocognit       # æµ‹è¯•è®¤çŸ¥å¤æ‚åº¦æ”¾æ¾
        - mnd          # æµ‹è¯•ä¸­å…è®¸é­”æ•°
        - lll            # æµ‹è¯•è¡Œé•¿åº¦æ”¾æ¾

    # ä¸»å‡½æ•°å¯ä»¥ç¨é•¿
    - path: main\.go
      linters:
        - funlen
        - gocyclo

    # ç¤ºä¾‹ä»£ç æ”¾æ¾è¦æ±‚
    - path: examples/
      linters:
        - errcheck
        - gosec
        - godox         # ç¤ºä¾‹ä¸­å…è®¸TODO
        - mnd
        - funlen

    # ç”Ÿæˆä»£ç è·³è¿‡æ‰€æœ‰æ£€æŸ¥
    - path: ".*\\.pb\\.go"
      linters:
        - all
    - path: ".*_generated\\.go"
      linters:
        - all
    - path: "wire_gen\\.go"
      linters:
        - all

    # Go generateç”Ÿæˆçš„è¡Œè·³è¿‡è¡Œé•¿åº¦æ£€æŸ¥
    - linters:
        - lll
      source: "^//go:generate "

    # å·¥å…·ç›®å½•çš„subprocessæ‰§è¡Œè±å…
    - linters:
        - gosec
      text: "G204"
      path: tools/

    # ç‰¹å®šgosecè§„åˆ™çš„è±å…
    - linters:
        - gosec
      text: "G304"  # æ–‡ä»¶è·¯å¾„æ³¨å…¥ (æŸäº›æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„)
      path: "internal/config/"

    # å…è®¸æŸäº›TODOæ ‡è®°
    - linters:
        - godox
      text: "TODO.*refactor"

    # åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­å…è®¸ä¸€äº›å¤æ‚åº¦
    - text: "cognitive complexity.*of func.*init.*is high"
      linters:
        - gocognit

    # å…è®¸æŸäº›é•¿å˜é‡å
    - text: "var-naming: don't use underscores in Go names"
      linters:
        - revive
      source: ".*_test.*"

    # å…è®¸ç‰¹å®šçš„magic numbers
    - text: "Magic number: 200"
      linters:
        - mnd
    - text: "Magic number: 404"
      linters:
        - mnd
    - text: "Magic number: 500"
      linters:
        - mnd


# Linterè®¾ç½®
linters-settings:
  # Go vetè®¾ç½®
  govet:
    enable-all: true
    disable:
      - fieldalignment  # å¯é€‰ç¦ç”¨å­—æ®µå¯¹é½æ£€æŸ¥

  # å®‰å…¨æ£€æŸ¥è®¾ç½® - 2025å¹´å¢å¼ºç‰ˆ
  gosec:
    severity: medium
    confidence: medium
    excludes:
      - G104  # å®¡è®¡é”™è¯¯ä¸æ£€æŸ¥ (ç”±errcheckå¤„ç†)
    config:
      G101:
        pattern: "(?i)passwd|pass|password|pwd|secret|token|key"
        ignore_entropy: false
        per_char_threshold: "3.0"
        truncate: "32"
      G401:
        pattern: "crypto/md5|crypto/sha1"
      G501:
        pattern: "crypto/md5"
      G502:
        pattern: "crypto/des"
      G503:
        pattern: "crypto/rc4"

  # åœˆå¤æ‚åº¦è®¾ç½®
  gocyclo:
    min-complexity: 15

  # è®¤çŸ¥å¤æ‚åº¦è®¾ç½®
  gocognit:
    min-complexity: 20

  # é‡å¤ä»£ç æ£€æµ‹
  dupl:
    threshold: 100

  # å¸¸é‡æ£€æµ‹
  goconst:
    min-len: 3
    min-occurrences: 3
    numbers: false

  # å‡½æ•°é•¿åº¦æ£€æŸ¥
  funlen:
    lines: 100
    statements: 60
    ignore-comments: true

  # è¡Œé•¿åº¦æ£€æŸ¥
  lll:
    line-length: 120

  # é­”æ•°æ£€æµ‹ - 2025å¹´å¢å¼ºç‰ˆ
  mnd:
    checks:
      - argument
      - case
      - condition
      - operation
      - return
      - assign
    ignored-numbers:
      - '0'
      - '1'
      - '2'
      - '3'
      - '10'
      - '100'
      - '1000'
    ignored-functions:
      - 'make'
      - 'strconv.FormatInt'
      - 'strconv.ParseInt'

  # åµŒå¥—ifå¤æ‚åº¦
  nestif:
    min-complexity: 5

  # é¢„åˆ†é…æ£€æŸ¥
  prealloc:
    simple: true
    range-loops: true
    for-loops: false

  # reviveè®¾ç½® (golintçš„ç°ä»£æ›¿ä»£)
  revive:
    severity: warning
    rules:
      - name: var-naming
        severity: warning
      - name: package-comments
        severity: warning
      - name: exported
        severity: warning
      - name: var-declaration
        severity: warning
      - name: blank-imports
        severity: warning
      - name: context-as-argument
        severity: warning
      - name: dot-imports
        severity: warning
      - name: error-return
        severity: warning
      - name: error-strings
        severity: warning
      - name: error-naming
        severity: warning
      - name: increment-decrement
        severity: warning
      - name: range
        severity: warning
      - name: receiver-naming
        severity: warning
      - name: time-naming
        severity: warning
      - name: unexported-return
        severity: warning
      - name: indent-error-flow
        severity: warning
      - name: errorf
        severity: warning
      - name: empty-block
        severity: warning
      - name: superfluous-else
        severity: warning
      - name: unused-parameter
        severity: warning
      - name: unreachable-code
        severity: warning
      - name: redefines-builtin-id
        severity: warning

  # å¯¼å…¥æ£€æŸ¥
  goimports:
    local-prefixes: github.com/go-mastery

  # é«˜çº§Goä»£ç æ£€æŸ¥
  gocritic:
    enabled-tags:
      - performance
      - style
      - experimental
      - diagnostic
      - opinionated
    disabled-checks:
      - commentedOutCode
      - whyNoLint
      - unnamedResult
    settings:
      captLocal:
        paramsOnly: true
      elseif:
        skipBalanced: true
      hugeParam:
        sizeThreshold: 80
      rangeExprCopy:
        sizeThreshold: 512
      rangeValCopy:
        sizeThreshold: 128

  # æ‹¼å†™æ£€æŸ¥
  misspell:
    locale: US
    ignore-words:
      - "color"
      - "behaviour"

  # è£¸è¿”å›æ£€æŸ¥
  nakedret:
    max-func-lines: 30

  # æœªä½¿ç”¨å‚æ•°æ£€æŸ¥
  unparam:
    check-exported: false

  # é”™è¯¯æ£€æŸ¥è®¾ç½®
  errcheck:
    check-type-assertions: true
    check-blank: true
    exclude-functions:
      - fmt:.*
      - io/ioutil:^Read.*

  # é™æ€æ£€æŸ¥è®¾ç½®
  staticcheck:
    checks: ["all"]

  # æ ·å¼æ£€æŸ¥è®¾ç½®
  stylecheck:
    checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]

  # ç©ºç™½å­—ç¬¦æ£€æŸ¥
  whitespace:
    multi-if: false
    multi-func: false

  # TODO/FIXMEæ£€æŸ¥
  godox:
    keywords:
      - NOTE
      - OPTIMIZE
      - HACK
      - TODO
      - BUG
      - FIXME

# Linterå¯ç”¨/ç¦ç”¨é…ç½® - 2025å¹´æ ‡å‡†
linters:
  enable:
    # åŸºç¡€é™æ€åˆ†æ (å¿…éœ€)
    - govet          # Goå®˜æ–¹vetå·¥å…·
    - errcheck       # æ£€æŸ¥æœªå¤„ç†çš„é”™è¯¯
    - staticcheck    # é«˜è´¨é‡é™æ€åˆ†æ
    - ineffassign    # æ£€æŸ¥æ— æ•ˆèµ‹å€¼
    - unused         # æ£€æŸ¥æœªä½¿ç”¨ä»£ç 
    - typecheck      # ç±»å‹æ£€æŸ¥
    - gosimple       # ç®€åŒ–ä»£ç å»ºè®®

    # å®‰å…¨ç›¸å…³ (å…³é”®)
    - gosec          # å®‰å…¨æ¼æ´æ£€æµ‹

    # ä»£ç è´¨é‡ (é‡è¦)
    - dupl           # é‡å¤ä»£ç æ£€æµ‹
    - gocyclo        # åœˆå¤æ‚åº¦æ£€æŸ¥
    - gocognit       # è®¤çŸ¥å¤æ‚åº¦æ£€æŸ¥
    - funlen         # å‡½æ•°é•¿åº¦æ£€æŸ¥
    - nestif         # åµŒå¥—ifå¤æ‚åº¦

    # ä»£ç é£æ ¼ (æ ‡å‡†åŒ–)
    - gofmt          # Goä»£ç æ ¼å¼åŒ–
    - gofumpt        # æ›´ä¸¥æ ¼çš„gofmt
    - goimports      # Goå¯¼å…¥æ ¼å¼åŒ–
    - revive         # golintçš„ç°ä»£æ›¿ä»£å“
    - stylecheck     # æ ·å¼æ£€æŸ¥
    - misspell       # æ‹¼å†™æ£€æŸ¥
    - whitespace     # ç©ºç™½å­—ç¬¦æ£€æŸ¥

    # æ€§èƒ½ç›¸å…³ (ä¼˜åŒ–)
    - prealloc       # åˆ‡ç‰‡é¢„åˆ†é…æ£€æŸ¥
    - gocritic       # é«˜çº§Goä»£ç æ£€æŸ¥

    # ä»£ç å¥åº·æ€§
    - unconvert      # ä¸å¿…è¦çš„ç±»å‹è½¬æ¢
    - goconst        # é‡å¤å¸¸é‡æ£€æµ‹
    - mnd            # é­”æ•°æ£€æµ‹ (æ›¿ä»£gomnd)
    - unparam        # æœªä½¿ç”¨å‚æ•°æ£€æµ‹
    - nakedret       # è£¸è¿”å›æ£€æŸ¥

    # å¹¶å‘å®‰å…¨
    - rowserrcheck   # SQLè¡Œé”™è¯¯æ£€æŸ¥
    - sqlclosecheck  # SQLå…³é—­æ£€æŸ¥

    # èµ„æºç®¡ç†
    - bodyclose      # HTTPå“åº”ä½“å…³é—­æ£€æŸ¥
    - noctx          # HTTPè¯·æ±‚ä¸Šä¸‹æ–‡æ£€æŸ¥

    # ä»£ç æ£€æŸ¥å¢å¼º
    - copyloopvar    # å¾ªç¯å˜é‡å¼•ç”¨æ£€æŸ¥ (æ›¿ä»£exportloopref)
    - exhaustive     # switchè¯­å¥å®Œæ•´æ€§æ£€æŸ¥
    - gochecknoinits # ç¦æ­¢initå‡½æ•°æ£€æŸ¥
    - goprintffuncname # printfå‡½æ•°åæ£€æŸ¥
    - nolintlint     # nolintæŒ‡ä»¤æ£€æŸ¥
    - predeclared    # é¢„å®šä¹‰æ ‡è¯†ç¬¦é®è”½æ£€æŸ¥

    # 2025å¹´æ–°å¢æ¨è
    - godox          # TODO/FIXMEæ£€æŸ¥
    - dogsled        # ç©ºç™½æ ‡è¯†ç¬¦æ£€æŸ¥
    - lll            # è¡Œé•¿åº¦æ£€æŸ¥

  disable: []

  fast: false